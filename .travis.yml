sudo: enabled

language: cpp

before_install:
  - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
  - sudo apt-get update -q
  - sudo apt-get install g++-7 -y
  - wget https://cmake.org/files/v3.12/cmake-3.12.2-Linux-x86_64.tar.gz -O /tmp/cmake.tar.gz
  - tar -xzf /tmp/cmake.tar.gz
  - export PATH=$PATH:$PWD/cmake-3.12.2-Linux-x86_64/bin/
  - git clone https://github.com/Microsoft/vcpkg.git
  - CXX=g++-7 ./vcpkg/bootstrap-vcpkg.sh
  - touch vcpkg/triplets/x64-linux-cxx14.cmake
  - echo "set(VCPKG_TARGET_ARCHITECTURE x64)" >> vcpkg/triplets/x64-linux-cxx14.cmake
  - echo "set(VCPKG_LIBRARY_LINKAGE static)" >> vcpkg/triplets/x64-linux-cxx14.cmake
  - echo "set(VCPKG_CMAKE_SYSTEM_NAME Linux)" >> vcpkg/triplets/x64-linux-cxx14.cmake
  - echo "set(VCPKG_CRT_LINKAGE dynamic)" >> vcpkg/triplets/x64-linux-cxx14.cmake
  - echo "set(VCPKG_CXX_FLAGS \"${VCPKG_CXX_FLAGS} -std=c++14\")" >> vcpkg/triplets/x64-linux-cxx14.cmake
  - echo "set(VCPKG_C_FLAGS \"${VCPKG_C_FLAGS}\")" >> vcpkg/triplets/x64-linux-cxx14.cmake
  - echo "set(VCPKG_BUILD_TYPE debug)" >> vcpkg/triplets/x64-linux-cxx14.cmake
  - echo "" >> vcpkg/triplets/x64-linux-cxx14.cmake
  - ./vcpkg/vcpkg update
  - CXX=g++-7 ./vcpkg/vcpkg install boost-asio:x64-linux-cxx14
  - CXX=g++-7 ./vcpkg/vcpkg install boost-beast:x64-linux-cxx14
  - CXX=g++-7 ./vcpkg/vcpkg install catch2:x64-linux-cxx14

install:
  - mkdir foxy
  - cp -r $TRAVIS_BUILD_DIR/* foxy

script:
  - mkdir foxy/build_debug
  - cd foxy/build_debug
  - cmake -DVCPKG_TOOLCHAIN_FILE=../../vcpkg/scripts/buildsystems/vcpkg.cmake -DCMAKE_TOOLCHAIN_FILE=../foxy-travis.cmake ..
  - cmake --build . --target all -- -j4
  - ctest .

notifications:
  email:
    false
